var ruleBuilderURL=FormSettings.ruleBuilderURL;var previewURL=FormSettings.previewURL;var formID=FormSettings.formID;var iID=FormSettings.iframe;var iH=FormSettings.iHeight;var iExists=false;var previewUnselected=function(a){a.preventDefault();$("#preview-container").hide();$("#"+iID).remove();return iExists=false};var previewSelected=function(d){d.preventDefault();$("#preview-container").show();var a=$(d.currentTarget).val();var c=(previewURL.indexOf("?")>=0?"&":"?");var f=previewURL+c+$.param({id:formID,theme_id:a},true);if(iExists===true){$("#"+iID).attr("src",f)}else{var b=$("<iframe></iframe>").attr({src:f,id:iID,frameborder:0,width:"100%",height:iH});$("#preview").html(b);return iExists=true}};$("#resizeFull").click(function(b){b.preventDefault();if(iExists){var a=$("#"+iID);a.height(a.contents().find("html").height());$(".toogleButton").toggle()}});$("#resizeSmall").click(function(a){a.preventDefault();if(iExists){$("#"+iID).height(iH);$(".toogleButton").toggle()}});$(document).ready(function(){if(typeof tinymce!=="undefined"){tinymce.init({selector:"#formconfirmation-mail_message, #formemail-message",height:300,plugins:"advlist autolink link image lists charmap print preview hr anchor searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime nonbreaking save table directionality paste",toolbar:"insertfile undo redo | styleselect | bold italic forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image table | preview fullscreen code",convert_urls:false,setup:function(g){g.ui.registry.addAutocompleter("field-list",{ch:"{",minChars:0,columns:1,fetch:function(i){var h=FormSettings.fieldList.filter(function(j){return j.text.indexOf(i)!==-1});return new tinymce.util.Promise(function(k){var j=h.map(function(l){return{value:"{{ "+l.value+" }} ",text:l.text,icon:l.value}});k(j)})},onAction:function(j,h,i){g.selection.setRng(h);g.insertContent(i);j.hide()}})}})}$("body").on("click",".placeholder-autocomplete",function(h){var g=$(h.currentTarget);g.textcomplete("destroy");g.textcomplete([{match:function(){return/(\.*){(\w*)$/},search:function(j,k,i){$.post(FormSettings.fieldListUrl,{id:FormSettings.formID,term:typeof i[2]==="undefined"?"":i[2],_csrf:$("meta[name=csrf-token]").attr("content")}).done(function(l){if(typeof l.data==="object"){var m=Object.keys(l.data).map(function(n){var o={};o[n]="<span>"+n+"</span>"+l.data[n];return o});k($.map(m,function(o){var n=o[Object.keys(o)[0]];return n.indexOf(j)===0?o:null}))}else{k([])}})},template:function(i){return i[Object.keys(i)[0]]},index:1,replace:function(j){var i=Object.keys(j)[0];return"{{ "+i+" }} "}}],{zIndex:1500,maxCount:-1})});toggleShared=function(g){if(g.val()==="0"||g.val()==="1"){$(".field-form-users").hide()}else{if(g.val()==="2"){$(".field-form-users").show()}}};toggleEditable=function(g){if(g.val()==="0"){$(".submission-editable-settings").hide()}else{$(".submission-editable-settings").show()}};toggleSchedule=function(g){if(g.val()==="0"){$(".field-form-schedule_start_date").hide();$(".field-form-schedule_end_date").hide()}else{$(".field-form-schedule_start_date").show();$(".field-form-schedule_end_date").show()}};togglePassword=function(g){if($("#form-use_password").is(":checked")===false){$(".field-form-password").hide()}else{$(".field-form-password").show()}};toggleUrls=function(g){if($("#form-authorized_urls").is(":checked")===false){$(".field-form-urls").hide()}else{$(".field-form-urls").show()}};toggleTotalLimit=function(g){if(g.val()==="0"){$(".field-form-total_limit_number").hide();$(".field-form-total_limit_time_unit").hide()}else{$(".field-form-total_limit_number").show();$(".field-form-total_limit_time_unit").show()}};toggleUserLimit=function(g){if(g.val()==="0"){$(".field-form-user_limit_type").hide();$(".field-form-user_limit_number").hide();$(".field-form-user_limit_time_unit").hide()}else{$(".field-form-user_limit_type").show();$(".field-form-user_limit_number").show();$(".field-form-user_limit_time_unit").show()}};toggleFormConfirmationFields=function(g){if(g.val()==="0"||g.val()==="1"){$(".field-formconfirmation-message").show();$(".field-formconfirmation-url").hide();$(".field-formconfirmation-seconds").hide();$(".field-formconfirmation-append").hide();$(".field-formconfirmation-alias").hide()}else{if(g.val()==="2"){$(".field-formconfirmation-message").hide();$(".field-formconfirmation-url").show();$(".field-formconfirmation-seconds").show();$(".field-formconfirmation-append").show();$(".field-formconfirmation-alias").show()}}};toggleFormConfirmationRuleFields=function(g){if(g.val()==="0"||g.val()==="1"){g.parents(".item").find(".message").show();g.parents(".item").find(".url").hide()}else{if(g.val()==="2"){g.parents(".item").find(".message").hide();g.parents(".item").find(".url").show()}}};toggleFormConfirmationEmailFields=function(g){if(g.val()==="0"){$(".field-formconfirmation-mail_to").hide();$(".field-formconfirmation-mail_from").hide();$(".field-formconfirmation-mail_from_name").hide();$(".field-formconfirmation-mail_cc").hide();$(".field-formconfirmation-mail_bcc").hide();$(".field-formconfirmation-mail_subject").hide();$(".field-formconfirmation-mail_message").hide();$(".field-formconfirmation-mail_receipt_copy").hide();$(".field-formconfirmation-mail_attach").hide();$(".field-formconfirmation-opt_in").hide();$(".field-formconfirmation-opt_in_type").hide();$(".field-formconfirmation-opt_in_message").hide();$(".field-formconfirmation-opt_in_url").hide()}else{if(g.val()==="1"){$(".field-formconfirmation-mail_to").show();$(".field-formconfirmation-mail_from").show();$(".field-formconfirmation-mail_from_name").show();$(".field-formconfirmation-mail_cc").show();$(".field-formconfirmation-mail_bcc").show();$(".field-formconfirmation-mail_subject").show();$(".field-formconfirmation-mail_message").show();$(".field-formconfirmation-mail_receipt_copy").show();$(".field-formconfirmation-mail_attach").show();$(".field-formconfirmation-opt_in").show();toggleFormConfirmationOptInFields($("#formconfirmation-opt_in").is(":checked"))}}};toggleFormConfirmationOptInFields=function(g){if(g){$(".field-formconfirmation-opt_in_type").show();toggleFormConfirmationOptInTypeFields($('[name$="FormConfirmation[opt_in_type]"]:checked'))}else{$(".field-formconfirmation-opt_in_type").hide();$(".field-formconfirmation-opt_in_message").hide();$(".field-formconfirmation-opt_in_url").hide()}};toggleFormConfirmationOptInTypeFields=function(g){if(g.val()==="1"){$(".field-formconfirmation-opt_in_message").hide();$(".field-formconfirmation-opt_in_url").show()}else{$(".field-formconfirmation-opt_in_message").show();$(".field-formconfirmation-opt_in_url").hide()}};toggleFormEmailFields=function(g){if(g.val()==="2"){$(".field-formemail-message").show()}else{$(".field-formemail-message").hide()}};$("#form-shared").find(".btn").on("click",function(g){toggleShared($(this).children())});$("#form-submission_editable").find(".btn").on("click",function(g){toggleEditable($(this).children())});$("#form-schedule").find(".btn").on("click",function(g){toggleSchedule($(this).children())});$("#form-total_limit").find(".btn").on("click",function(g){toggleTotalLimit($(this).children())});$("#form-user_limit").find(".btn").on("click",function(g){toggleUserLimit($(this).children())});$("#formconfirmation-type").find(".btn").on("click",function(g){toggleFormConfirmationFields($(this).children())});$("#formconfirmation-rules").on("click",".btn-group .btn",function(g){toggleFormConfirmationRuleFields($(this).children())});$("#formconfirmation-send_email").find(".btn").on("click",function(g){toggleFormConfirmationEmailFields($(this).children())});$("#formconfirmation-opt_in").on("click",function(g){toggleFormConfirmationOptInFields($(this).is(":checked"))});$("#formconfirmation-opt_in_type").find(".btn").on("click",function(g){toggleFormConfirmationOptInTypeFields($(this).children())});$("#formemail-type").find(".btn").on("click",function(g){toggleFormEmailFields($(this).children())});toggleShared($('[name$="Form[shared]"]:checked'));toggleEditable($('[name$="Form[submission_editable]"]:checked'));toggleSchedule($('[name$="Form[schedule]"]:checked'));togglePassword();toggleUrls();toggleTotalLimit($('[name$="Form[total_limit]"]:checked'));toggleUserLimit($('[name$="Form[user_limit]"]:checked'));toggleFormConfirmationFields($('[name$="FormConfirmation[type]"]:checked'));toggleFormConfirmationEmailFields($('[name$="FormConfirmation[send_email]"]:checked'));toggleFormEmailFields($('[name$="FormEmail[type]"]:checked'));$("#submission-editable-conditions-builder").conditionsWidget({field:"#form-submission_editable_conditions",url:ruleBuilderURL,initialize:true}).end();var d=/^(.+?)([-\d-]{1,})(.+)$/i;var c=/(^.+?)([\[\d{1,}\]]{1,})(\[.+\]$)/i;var f=function(l,j){var n=l.attr("id");var h=n;if(n!==undefined){var m=n.match(d);if(m&&m.length===4){m[2]=m[2].substring(1,m[2].length-1);var g=m[2].split("-");g[0]=j;if(g.length>1){for(var k=g.length-1;k>=1;k--){g[k]=l.closest(".item").index()}}h=m[1]+"-"+g.join("-")+"-"+m[3];l.attr("id",h)}else{h=n+j;l.attr("id",h)}}if(n!==h){l.closest(".item").find("label[for='"+n+"']").attr("for",h)}return h};var a=function(l,j){var h=l.attr("name");if(h!==undefined){var m=h.match(c);if(m&&m.length===4){m[2]=m[2].replace(/\]\[/g,"-").replace(/\]|\[/g,"");var g=m[2].split("-");g[0]=j;if(g.length>1){for(var k=g.length-1;k>=1;k--){g[k]=l.closest(".item").index()}}h=m[1]+"["+g.join("][")+"]"+m[3];l.attr("name",h)}}return h};var b=function(h,g){h.removeAttr("disabled")};var e=function(){$(".item").each(function(g){var h=$(this);$(this).find("*").each(function(){f($(this),g);a($(this),g);b($(this),g)})})};e();$(".item").each(function(g){toggleFormConfirmationRuleFields($(this).find('[name$="FormConfirmationRule['+g+'][action]"]:checked'));$(this).find(".rule-builder-conditions").attr("id","conditions-builder-"+g).conditionsWidget({field:"#formconfirmationrule-"+g+"-conditions",url:ruleBuilderURL,initialize:true}).end()});$("form").on("click",".add-item",function(){var i=$(".item").size();var h=$("#itemTemplate"),g=h.clone().removeClass("hide").addClass("item").removeAttr("id").insertBefore(h);g.find("#formconfirmationrule-action").attr("id","formconfirmationrule-action-"+i).end().find("#formconfirmationrule-action-"+i+" .btn:first").click().end().find('[name="FormConfirmationRule[action]"]').attr("name","FormConfirmationRule["+i+"][action]").attr("id","formconfirmationrule-"+i+"-action").removeAttr("disabled").end().find('[name="FormConfirmationRule[conditions]"]').attr("name","FormConfirmationRule["+i+"][conditions]").attr("id","formconfirmationrule-"+i+"-conditions").removeAttr("disabled").end().find('[name="FormConfirmationRule[message]"]').attr("name","FormConfirmationRule["+i+"][message]").attr("id","formconfirmationrule-"+i+"-message").removeAttr("disabled").end().find('[name="FormConfirmationRule[url]"]').attr("name","FormConfirmationRule["+i+"][url]").attr("id","formconfirmationrule-"+i+"-url").removeAttr("disabled").end().find('label[for="formconfirmationrule-append"]').attr("for","formconfirmationrule-"+i+"-append").end().find('[name="FormConfirmationRule[append]"]').attr("name","FormConfirmationRule["+i+"][append]").attr("id","formconfirmationrule-"+i+"-append").removeAttr("disabled").end().find('label[for="formconfirmationrule-alias"]').attr("for","formconfirmationrule-"+i+"-alias").end().find('[name="FormConfirmationRule[alias]"]').attr("name","FormConfirmationRule["+i+"][alias]").attr("id","formconfirmationrule-"+i+"-alias").removeAttr("disabled").end().find('[name="FormConfirmationRule[seconds]"]').attr("name","FormConfirmationRule["+i+"][seconds]").attr("id","formconfirmationrule-"+i+"-seconds").removeAttr("disabled").end().find(".rule-builder-conditions").attr("id","conditions-builder-"+i).conditionsWidget({field:"#formconfirmationrule-"+i+"-conditions",url:ruleBuilderURL,initialize:true}).end();i++}).on("click",".copy-item",function(){var i=$(this).closest("fieldset");var h=i.find("label.btn.active");var g=i.clone().removeAttr("id").insertAfter(i);e();var j=g.index();g.find(".rule-builder-conditions").attr("id","conditions-builder-"+j).conditionsWidget({field:"#formconfirmationrule-"+j+"-conditions",url:ruleBuilderURL}).end();h.click()}).on("click",".remove-item",function(){var g=$(this).closest("fieldset");g.remove();e()})});